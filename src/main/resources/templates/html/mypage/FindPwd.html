<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>reset pwd</title>
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
<script type="text/javascript">
$(function(){
	//이벤트 핸들러 연결
	pwd1.addEventListener("focusout", checkPw);
	pwd.addEventListener("focusout", checkPw2);
});

//비밀번호
function checkPw(){
	var pwd1 = document.querySelector('#new_pwd');
	var error = document.querySelectorAll('.error_next_box');
	var pwPattern = /[a-zA-Z0-9~!@#$%^&*()_+|<>?:{}]{8,16}/;
	if(pwd1.value === ""){
		error[0].innerHTML ="필수 정보입니다.";
        error[0].style.display = "block";
        error[0].style.color = "red";
	}else if(!pwPattern.test(pwd1.value)){
        error[0].innerHTML = "8~16자의 영문 대 소문자, 숫자,특수문자를 사용하세요.";
        
        //pwdMsg.innerHTML = "사용불가"
        //pwdMsg.style.display = "block";
        
        error[0].style.display = "block";
        error[0].style.color = "red";
	}else{
		error[0].innerHTML = "안전";
        //pwdMsg.innerHTML = "안전"
       /* 	pwdMsg.style.display = "block";
    	pwdMsg.style.color = "#08A600"; */
        error[0].style.display = "none";
    	
	}
}

//비밀번호 재확인
function checkPw2(){
	var pwd = document.querySelector('#new_pwd2');
	var pwd1 = document.querySelector('#new_pwd');
	var error = document.querySelectorAll('.error_next_box');
	if(pwd.value===pwd1.value && pwd.value!=""){
		error[1].style.display = "none";
	}else if(pwd.value!==pwd1.value){
		error[1].innerHTML = "비밀번호가 일치하지 않습니다";
		error[1].style.display = "block";
		error[1].style.color = "red";
	}
	if(pwd.value===""){
		error[1].innerHTML = "필수 정보입니다.";
		error[1].style.display="block";
		error[1].style.color = "red";
	}
}

	var obj=$('#pwdchangeform').serialize();
	var uid = '[[${user.userid}]]'
	var now_pwd = '[[${user.pwd}]]'
	var new_pwd = document.querySelector('#pwd');
/*
	if(now_pwd==new_pwd)
		{
			function changepwd()
			{
				$.ajax({
					url:'/health/checkpwd',
					method:'post',
					data:obj,
					cache:false,
					dataType:'json',
					success:function(res){
						alert("변경됨")
						location.href="/health/"
					},
					error : function(xhr,status,err){
						alert('에러:' + err);
					}
				});
			}		
		}
	else{
		alert("정확한 비밀번호를 입력해 주세요.")
		location.href= "/health/findpwd/"+uid;
	}*/
	
</script>
</head>
<body>
<h2>비밀번호 변경</h2>

<form id="pwdchangeform" method="post">
	<p>
		<label for='pwd'>현재 비밀번호</label>
		<input type="password" id='pwd' name='pwd'>
	</p>
	<p>
		<label for='new_pwd'>새 비밀번호</label>
		<input type="password" id='new_pwd' name='new_pwd' required>
		<span class="error_next_box" id="pwdMsg" style="display:none" aria-live="assertive"></span>
	</p>
	<p>
		<label for='new_pwd2'>새 비밀번호 확인</label>
		<input type="password" id='new_pwd2' name='new_pwd2' required>
		<span class="error_next_box" id="pwdMsg" style="display:none" aria-live="assertive"></span>
	</p>
	<button type="submit">비밀번호 변경</button>
</form>
</body>
</html>