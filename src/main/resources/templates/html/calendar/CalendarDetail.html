<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
<script src="/js/Calendar/CalendarDetail.js"></script>
<script type="text/javascript">
function deleteCal(pnum,num)
{
	if(!confirm('정말로 현재 게시글을 삭제하시겠어요?')) return;

	$.ajax ({
		url : '/calen/delete',
		method : 'post',
		data : {
			"num" : pnum,
			"anum" : num
		},
		cache : false,
		dateType : 'json',
		success : function(res){
			alert(res.deleted ? "삭제성공" : "삭제실패");
			if(res.deleted)	{
				location.href='/calen/getCalendar';
			}
		},
		error:function(xhr,status,err){
		alert(err);
	}
	});
}
</script>
</head>
<body>
<div>
    <div th:replace="fragments/common :: header"></div>
</div>
<table>
	<thead>
		<tr>
			<td>날짜</td>
			<td>식사</td>
			<td>내용</td>
			<td>사진</td>
		</tr>
	</thead>
	<tbody>
		<tr th:each="list : ${mlist}">
			<td th:each="cal : ${list.cal}"
			 	th:text="${cal.datetime}">
				
			</td>
			<td th:each="sch : ${list.sch}"
				th:text="${sch.when}">
			
			</td>
			<td th:each="sch : ${list.sch}"
				th:text="${sch.content}">
				
			</td>
			<td>
				<div th:each="sch : ${list.sch}">
					<div th:each="att : ${sch.attlist}">
						<img th:src="@{/images/calendar/}+${att.pname}" width="84" height="84">		
						<input type="hidden"  th:value="${att.pnum}">
					</div>
				</div>
			</td>
		</tr>
	</tbody>
</table>
<div th:each="list : ${mlist}">
	<div th:each="sch : ${list.sch}">
		<button type="button" th:onclick="|location.href='@{'/calen/edit/'+${sch.pnum}}'|">수정</button>
		<button type="button" th:onclick="|javascript:deleteCal('${sch.pnum}','${sch.num}')|">삭제</button>
	</div>
</div>
</body>
</html>