<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.demo.mapper.AdminBoardMapper">

	<select id="QAlist"
		resultType="map">
		SELECT q.qnum, q.title, q.author, q.qdate, q.content, q.hit, a.anum, a.title as atitle, a.author as a_author, a.adate, a.hit as ahit, a.content as a_content, attsize, attname, attid
		FROM queBoard q LEFT OUTER JOIN ansBoard a
		ON q.qnum = a. qnum 
        LEFT OUTER JOIN attach c
        ON q.qnum= c.qnum
		ORDER BY q.qnum DESC, a.anum ASC
	</select>
	
	<insert id="addQueBoard"
		parameterType="com.example.demo.vo.OneBoard">
		INSERT INTO queBoard(qnum, title, author, qdate, content, hit)
		VALUES(QUEBOARD_SEQ.NEXTVAL, #{title}, #{author}, sysdate, #{content}, #{hit})
		
	</insert>
		 
	<insert id="saveAttach"
		parameterType="com.example.demo.vo.AttachBoard">
		
INSERT INTO attach(attid, attsize, attname, qnum, anum)
	SELECT ATTACH_SEQ.NEXTVAL, #{attsize, jdbcType=VARCHAR}, #{attname, jdbcType=VARCHAR}, 
	(SELECT MAX(qnum) FROM queBoard) AS qnum, 
	(SELECT MAX(anum) FROM ansBoard) AS anum FROM DUAL
		</insert>
	
<!--	
	<update id="saveAttach"
	parameterType="list">
	INSERT INTO attachtb (attid, attsize, attname, qnum, anum)
	SELECT
	ATTACH_SEQ.NEXTVAL AS attid, t.* FROM
	(
		<foreach collection="list" item="item" index="index" separator=" union all ">
		SELECT
		 #{item.attsize} AS attsize, 
		#{item.attname} AS attname, 
			(SELECT MAX(qnum) FROM queBoard) AS qnum, 
			(SELECT MAX(anum) FROM ansBoard) AS anum 
	FROM DUAL
		</foreach>
	)t
	</update> -->
		
	<insert id="addAnsBoard"
		parameterType="com.example.demo.vo.OneBoard">
		INSERT INTO queBoard(anum, title, author, adate, content, hit, qnum)
		VALUES( ANSBOARD_SEQ.NEXTVAL, #{title}, #{author}, #{adate}, #{content},  #{hit}, #{qnum} )
		
	</insert>
	
</mapper>